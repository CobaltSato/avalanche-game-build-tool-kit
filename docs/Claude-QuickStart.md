# Claude Code 実践ワーク

> **Anthropic x Forum Ventures ハッカソン優勝者の設定集を体験する**

このプロジェクトには [everything-claude-code](https://github.com/affaan-m/everything-claude-code) のベストプラクティスが組み込まれています。
**10のワーク**ですぐに体験できます。各ワークは数分で完了します。

> 各機能の詳しい説明は [Guide.md](./Guide.md) を参照してください。

---

## 背景: この設定が生まれた経緯

[everything-claude-code](https://github.com/affaan-m/everything-claude-code) は、Anthropic x Forum Ventures ハッカソン優勝者が**10ヶ月以上かけて本番環境で使い込んだ** Claude Code の設定集です。
このプロジェクトにはその設計思想が組み込まれています。

```
  ┌────────────────── 6つのコア原則 ──────────────────────┐
  │                                                       │
  │  1. エージェントファースト  専門家に任せる（5ツール）    │
  │  2. TDD中心              テストが先、実装は後          │
  │  3. セキュリティファースト シークレット検出・自動検証    │
  │  4. コンテキスト管理      MCP 10個以下・ツール80個以下  │
  │  5. モジュラー設計        小さいファイル・役割ごとに分割 │
  │  6. 自動化               フックで品質チェック自動実行   │
  │                                                       │
  └───────────────────────────────────────────────────────┘
```

> 設計思想の詳細 → [Guide.md: 設計思想](./Guide.md#設計思想)

---

## 全体マップ

```
  ┌───────────────────────────────────────────────────────────────────┐
  │                  Work 0 + 10ワークの全体像                          │
  │                                                                   │
  │   Work 0: 初期セットアップ                                          │
  │   ┌──────────────────────────────────────────────┐               │
  │   │ .mcp.json に Playwright + Context7 を設定     │               │
  │   │ （API キー不要・npx で自動起動）               │               │
  │   └──────────────────────────────────────────────┘               │
  │                                                                   │
  │   基本ワーク（1-7）                                                │
  │   ─────────────────────────────────────────────────               │
  │                                                                   │
  │   Work 1          Work 2           Work 3                         │
  │   ┌──────┐       ┌──────┐        ┌──────┐                        │
  │   │/plan │ ────→ │/tdd  │ ─────→ │/code │                        │
  │   │計画  │       │テスト │        │review│                        │
  │   └──────┘       └──────┘        └──────┘                        │
  │       コマンド       TDD           レビュー                        │
  │                                                                   │
  │   Work 4                    Work 5           Work 6               │
  │   ┌──────────────┐        ┌──────┐         ┌──────┐              │
  │   │ Playwright   │        │ MCP  │         │Contxt│              │
  │   │  + TDD       │        │ブラウザ│         │  7   │              │
  │   │ (E2E実装)    │        │ 操作  │         │ 検索 │              │
  │   └──────────────┘        └──────┘         └──────┘              │
  │       ★ 真髄                MCP               MCP                │
  │                                                                   │
  │   Work 7                                                          │
  │   ┌──────────────┐                                                │
  │   │エージェント   │                                                │
  │   │ 直接呼出し   │                                                │
  │   └──────────────┘                                                │
  │                                                                   │
  │   追加ワーク（8-10）                                               │
  │   ─────────────────────────────────────────────────               │
  │                                                                   │
  │   Work 8         Work 9          Work 10                          │
  │   ┌──────┐      ┌──────┐       ┌──────┐                          │
  │   │ルール │      │フック │       │その他 │                          │
  │   │ 確認 │      │ 確認 │       │コマンド│                          │
  │   └──────┘      └──────┘       └──────┘                          │
  │    自動適用       自動実行      応用コマンド                        │
  │                                                                   │
  └───────────────────────────────────────────────────────────────────┘
```

### 6つの設定カテゴリ

```
  カテゴリ         たとえ       体験する Work     公式定義
  ──────────    ──────      ────────────    ──────────────────
  commands/     ボタン        Work 1,2,3,10   user-invoked actions
  agents/       専門家        Work 7          complex multi-step processes
  skills/       マニュアル     (自動参照)       auto-triggered behaviors
  rules/        交通法規       Work 8          常に従うルール
  hooks         監視カメラ     Work 9          イベント駆動の自動チェック
  MCP           外部連携       Work 5,6        外部サービス連携
```

> 各カテゴリの詳細な解説 → [Guide.md: 全体像](./Guide.md#全体像)
> コマンド・エージェント・スキルの違い → [Guide.md: 最重要セクション](./Guide.md#コマンドエージェントスキルの違い最重要)

---

## Work 0: 初期セットアップ

**目的**: ワークに必要な MCP サーバーを準備する

### MCP とは

MCP（Model Context Protocol）は Claude に**外部ツールとの連携能力**を与える仕組みです。
このプロジェクトでは 2 つの MCP サーバーを使います。

```
  MCP サーバー          役割                    API キー
  ──────────────      ──────────────────      ──────────
  Playwright          ブラウザ操作（Work 5）    不要
  Context7            最新ドキュメント検索（Work 6）  不要
```

### 確認: `.mcp.json`

プロジェクトルートの `.mcp.json` に以下が設定されていれば OK です。

```json
{
  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": ["@playwright/mcp@latest"]
    },
    "context7": {
      "command": "npx",
      "args": ["-y", "@upstash/context7-mcp@latest"]
    }
  }
}
```

> どちらも **API キー不要**で、`npx` 経由で自動ダウンロード・起動されます。

### 動作確認

Claude Code を起動して `/mcp` と入力すると、接続中の MCP サーバー一覧が表示されます。

```
/mcp
```

`playwright` と `context7` が表示されていれば準備完了です。

> MCP の詳細 → [Guide.md: MCP設定](./Guide.md#mcp設定)

---

## Work 1: スラッシュコマンドを体験する

**目的**: `/plan` コマンドで実装計画を作成する

```
  あなたの入力                    裏で起きること
  ──────────────────            ──────────────────────
  /plan カウンターに            コマンド（plan.md）
    リセットボタンを        ──→   │
    追加したい                    ▼
                              planner エージェントが起動
                                 │
                                 ▼
                              実装計画を作成
                              ・変更ファイルの特定
                              ・実装手順
                              ・注意点・リスク
                                 │
                                 ▼
                              承認を求められる
```

### やること

```
/plan カウンターコンポーネントにリセットボタンを追加したい
```

### 確認ポイント

- [ ] 計画が step-by-step で示されたか
- [ ] 変更対象のファイルが特定されたか
- [ ] 実装に移る前に承認を求められたか

> `/plan` は**コードを書く前に考える**ことを強制します。いきなり実装するより手戻りが少なくなります。

### 豆知識: /plan で動くのはエージェント？スキル？

`/plan` コマンドは **planner エージェント**を起動します。
「plan スキル」は存在しません。コマンドとエージェントの2段構成です。

```
  /plan
    └─→ コマンド (commands/plan.md)
          └─→ planner エージェント (agents/planner.md)  ← これが動く
                └─→ plan スキル → 存在しない！
```

すべてのコマンドがスキルを持つわけではありません。
コマンドとスキルの違いが気になったら [Guide.md の解説](./Guide.md#plan-を打つとスキルが動くのエージェントが動くの) を参照してください。

> コマンド全一覧（19個） → [Guide.md: スラッシュコマンド](./Guide.md#スラッシュコマンド)
> コマンド・エージェント・スキルの対応マップ → [Guide.md: 対応関係マップ](./Guide.md#対応関係マップ)

---

## Work 2: TDD（テスト駆動開発）を体験する

**目的**: `/tdd` コマンドで RED → GREEN → REFACTOR サイクルを体験する

```
  /tdd doubleNumber を作成したい

       ┌───────────┐   最小限の   ┌───────────┐
       │  ① RED    │    実装      │  ② GREEN  │
       │ テストを書く│ ─────────→  │ テストを通す│
       │ （失敗する）│             │ （成功する）│
       └───────────┘             └─────┬─────┘
                                       │
                                 コード改善
                                       │
                                 ┌─────▼─────┐
                                 │③ REFACTOR │
                                 │ 改善する    │
                                 └───────────┘
```

### やること

```
/tdd 数値を2倍にする関数 doubleNumber を作成したい
```

### 確認ポイント

- [ ] テストが**先に**書かれたか（RED）
- [ ] テストが最初は**失敗した**か
- [ ] 実装後にテストが**通った**か（GREEN）
- [ ] カバレッジ80%以上を目指す説明があったか

> TDD は everything-claude-code の中心的なワークフローです。テストを先に書くことで、バグの早期発見とリファクタリングの安全性を確保します。

### 豆知識: /tdd では3つ全部が動く

`/plan` と違い、`/tdd` は**コマンド・エージェント・スキルの3つ全部**が関わります。

```
  /tdd
    └─→ コマンド (commands/tdd.md)          ← 「TDDでやれ」という指示書
          └─→ tdd-guide エージェント         ← 実際にテストを書く専門家
                └─→ tdd-workflow スキル      ← テストの書き方・パターン集を参照
```

公式定義（everything-claude-code）によると：
> "Commands are essentially skills executed via slash commands"
> （コマンドは本質的に、スラッシュで実行されるスキル）

つまり中身は似ていますが、**呼び出し方**が違います：

```
  コマンド = user-invoked actions     あなたが /tdd と明示的に呼ぶ
  スキル   = auto-triggered behaviors  Claude が自動で参照する（呼ぶ必要なし）
```

> TDD ワークフローの全体像 → [Guide.md: TDDワークフロー](./Guide.md#tddワークフロー)
> コマンドとスキルの本質的な違い → [Guide.md: コマンドとスキルは何が違う？](./Guide.md#コマンドとスキルは何が違う)

---

## Work 3: コードレビューを体験する

**目的**: `/code-review` でコード品質をチェックする

```
  /code-review app/page.tsx をレビューして

  code-reviewer エージェントが起動
       │
       ├─→ security-review スキルを参照
       │     OWASP Top 10 チェック
       │
       ├─→ coding-standards スキルを参照
       │     コーディング規約チェック
       │
       └─→ 重要度順にレポート
             CRITICAL > HIGH > MEDIUM > LOW
```

### やること

```
/code-review app/page.tsx をレビューして
```

または Work 2 で作成したコードをレビュー：

```
/code-review 今作成したコードをレビューして
```

### 確認ポイント

- [ ] セキュリティの観点でチェックされたか
- [ ] 問題点が重要度順に並んでいるか
- [ ] 修正案も提示されたか

> `.claude/rules/security.md` のルールにより、**コミット前の必須チェック**が自動化されます。

> エージェント一覧と得意分野 → [Guide.md: エージェント](./Guide.md#エージェント)
> スキル（自動参照される知識） → [Guide.md: スキル](./Guide.md#スキル)

---

## Work 4: Playwright + TDD で UI 機能を実装する

> これが **everything-claude-code の真髄** です。
> ブラウザテストを先に書き、UI を実装し、テストが通ることを確認します。

```
  ★ Work 4 の流れ（Playwright E2E + TDD）

  Step 1: /plan で計画
       │
       ▼
  Step 2: Playwright E2E テストで TDD 実装

       ┌──────────────────────────────────────────┐
       │                                          │
       │  ① RED:   E2E テストを書く（失敗する）     │
       │     tests/counter.spec.ts に追加          │
       │     → +10 ボタンはまだないので失敗         │
       │                │                         │
       │                ▼                         │
       │  ② GREEN: +10 ボタンを実装する            │
       │     Counter.tsx にボタン追加               │
       │     → テストが通る！                      │
       │                │                         │
       │                ▼                         │
       │  ③ REFACTOR: コードを整理                 │
       │     セレクタの厳密化等                     │
       │                                          │
       └──────────────────────────────────────────┘
```

### 前提条件

```bash
npm run dev   # 開発サーバーを起動しておく
```

### やること

#### Step 1: 計画を立てる

```
/plan カウンターコンポーネントに +10 ボタンを追加したい
```

計画が表示されたら `yes` で承認。

#### Step 2: Playwright E2E テストで TDD 実装を依頼

```
Playwright E2E テストを使った TDD で実装して。
テストを先に書いて、失敗を確認してから実装してください。
```

### 確認ポイント

- [ ] **テストが先に書かれた**か（RED）
- [ ] テストが最初は**失敗した**か
- [ ] 実装後にテストが**通った**か（GREEN）
- [ ] `npx playwright test` で全テスト PASS したか

### テスト実行

```bash
npx playwright test tests/counter.spec.ts --reporter=list
```

> Playwright E2E + TDD の組み合わせで、UI の品質を保証します。テストが先にあることで「何を作るべきか」が明確になります。

> TDD サイクルの詳細図 → [Guide.md: TDDワークフロー](./Guide.md#tddワークフロー)
> 開発ワークフロー全体の流れ → [Guide.md: 開発ワークフロー全体図](./Guide.md#開発ワークフロー全体図)

---

## Work 5: Playwright MCP でブラウザを直接操作する

**目的**: MCP（外部サービス連携）の威力を体験する

```
  あなたの指示                  Playwright MCP の動き
  ──────────────────          ──────────────────────
  「localhost:3000 を          ① ブラウザを起動
   開いて +10 を3回       ──→  ② browser_snapshot で要素取得
   クリックして 30 に          ③ browser_click で +10 をクリック x3
   なることを確認」            ④ 値が 30 か確認して報告
```

### やること

```
localhost:3000 を開いて、+10 ボタンを3回クリックして、値が 30 になることをブラウザ上で確認して
```

### 確認ポイント

- [ ] ブラウザが自動で起動したか
- [ ] ボタンが正しくクリックされたか
- [ ] カウンターの値が 30 になったか

### 発展

```
localhost:3000 でカウンターを操作して、コンソールエラーがないか確認して
```

> Playwright MCP により、Claude がブラウザを直接操作してテスト・デバッグ・動作確認ができます。

> MCP の仕組みとコンテキストへの影響 → [Guide.md: MCP設定](./Guide.md#mcp設定)

---

## Work 6: Context7 で最新ドキュメントを検索する

**目的**: AI の知識が古くても最新情報を取得できることを体験する

```
  あなたの指示                  Context7 MCP の動き
  ──────────────────          ──────────────────────────
  「ethers.js v6 で            ① resolve-library-id
   コントラクトを           ──→     ライブラリ ID を取得
   呼び出す方法を              ② query-docs
   Context7 で調べて」             最新ドキュメントを取得
                               ③ コード例を含む回答を提供
```

### やること

```
ethers.js v6 でコントラクトを呼び出す方法を、Context7 で調べて教えて
```

または：

```
Next.js の Server Actions の書き方を Context7 で調べて
```

### 確認ポイント

- [ ] ライブラリ ID が解決されたか（例: `/ethers-io/ethers.js`）
- [ ] 最新のドキュメントが取得されたか
- [ ] コード例が含まれていたか

> AI の学習データは古くなりがちですが、Context7 で**最新情報をリアルタイムに取得**できます。

> MCP の推奨設定と注意点 → [Guide.md: MCP設定](./Guide.md#mcp設定)

---

## Work 7: エージェントを直接呼び出す

**目的**: 9つの専門エージェントの使い分けを体験する

```
  ┌─ 企画 ──────────────────────────────────────┐
  │  planner ··········· 実装計画の作成           │
  │  architect ········· システム設計             │
  ├─ 開発 ──────────────────────────────────────┤
  │  tdd-guide ········· テスト駆動開発           │
  │  build-error-resolver  ビルドエラー解決       │
  ├─ 品質 ──────────────────────────────────────┤
  │  code-reviewer ····· コード品質レビュー        │
  │  security-reviewer · セキュリティ脆弱性分析    │
  │  e2e-runner ········ E2E テスト生成・実行      │
  ├─ 保守 ──────────────────────────────────────┤
  │  refactor-cleaner ·· 不要コード削除           │
  │  doc-updater ······· ドキュメント更新          │
  └─────────────────────────────────────────────┘
```

### やること

```
security-reviewer エージェントで packages/avalanche-wallet のセキュリティをチェックして
```

または：

```
architect エージェントでこのプロジェクトのアーキテクチャを説明して
```

### 確認ポイント

- [ ] 指定したエージェントが呼び出されたか
- [ ] エージェントの専門性が発揮されたか

> 各エージェントは**必要最小限のツールだけ**を持っています（5個程度）。50個のツールを持つ汎用エージェントより**高速で正確**です。

> エージェント一覧と主なツール → [Guide.md: エージェント](./Guide.md#エージェント)
> 「なぜ専門エージェントか」の設計思想 → [Guide.md: 設計思想](./Guide.md#設計思想)

---

## Work 8: ルールの動作を確認する

**目的**: `.claude/rules/` のルールが自動適用されることを体験する

```
  あなた: 「APIキーをハードコードして」

  Claude の動作:
  ┌─────────────────────────────────────────────────┐
  │  security.md ルールが発動！                       │
  │                                                  │
  │  ✗ const apiKey = "sk-xxxxx"      ← 拒否される  │
  │  ✓ const apiKey = process.env.API_KEY  ← 提案   │
  └─────────────────────────────────────────────────┘
```

### やること

```
APIキーをハードコードしたコードを書いて
```

または：

```
console.log を残したコードを書いて
```

### 確認ポイント

- [ ] シークレットのハードコードが拒否されたか
- [ ] `process.env` を使うように提案されたか
- [ ] `console.log` が検出されて警告が表示されたか

> ルールは**常に自動適用**されます。人間が忘れがちなセキュリティチェックを自動化します。

> 8つのルール一覧と効果 → [Guide.md: ルール](./Guide.md#ルール)

---

## Work 9: フックの動作を確認する

**目的**: わざと型エラーを書いて、フックが自動でキャッチする体験をする

```
  あなた: 「型エラーのあるコードを書いて」
       │
       ▼
  Claude が .tsx ファイルを編集（Edit / Write ツール）
       │
       ▼
  PostToolUse フックが自動発動！
       │
       ├── ① Prettier   自動フォーマット（静かに実行）
       │
       ├── ② TypeScript  型チェック
       │     → [Hook] TS errors: ... が表示される ★ ここを体験
       │
       └── ③ console.log 検出（もしあれば）
             → [Hook] WARNING: console.log found
```

### やること

#### Step 1: わざと型エラーを書かせる

Counter.tsx の `setCount` は `number` しか受け付けません。
わざと `string` を渡すコードを書かせて、フックに検出させましょう。

> **重要**: Claude は賢いので、ただ間違ったコードを頼むと勝手に正しく直します。
> 「フックの確認のためにわざと書いて」と**意図を伝える**のがコツです。

```
フックの動作確認をしたい。Counter.tsx の setCount に文字列 "hello" を渡すボタンを、わざと型エラーのまま追加して。直さないで。
```

#### Step 2: フックが自動でキャッチすることを確認

何もしなくて OK です。Claude がファイルを編集した直後に **PostToolUse フック**が自動で走り、
以下のような出力が表示されます：

```
⏺ Update(app/components/Counter.tsx)
  ⎿  Added 6 lines
      27          >
      28            +
      29          </button>
      30 +        <button
      31 +          onClick={() => setCount("hello")}
      32 +          style={{ fontSize: "1.5rem", padding: "0.5rem 1.5rem" }}
      33 +        >
      34 +          Bug
      35 +        </button>
      36        </div>
      37      </section>
      38    );
  ⎿  Running PostToolUse hooks…                       ← ★ ここ！
  ⎿  Found 1 new diagnostic issue in 1 file
```

> **ポイント**: あなたは `tsc` を実行していません。**フックが勝手に型チェックを実行した**のです。

#### Step 3（おまけ）: console.log も検出させる

```
Counter.tsx に console.log("debug") を1行追加して
```

**期待**: 型エラーに加えて `[Hook] WARNING: console.log found` も表示される

### 確認ポイント

- [ ] 自分で `tsc` を実行していないのに型エラーが表示されたか
- [ ] `[Hook] TS errors:` というメッセージが見えたか
- [ ] （おまけ）`console.log` 警告も表示されたか

### 裏で何が起きている？

```
  .claude/settings.json の hooks 設定
  ─────────────────────────────────

  PostToolUse (Edit|Write にマッチ):
    1. Prettier で自動整形
    2. npx tsc --noEmit でプロジェクト全体を型チェック
       → 編集したファイルのエラー行だけ抽出して表示
    3. console.log が含まれていたら警告
```

> フックにより、**型エラーやデバッグコードの混入を自動防止**します。
> 人間が忘れても、フックは忘れません。

> フックの種類と実行フロー → [Guide.md: フック](./Guide.md#フック自動チェック)

---

## Work 10: その他のコマンドを体験する

**目的**: 応用コマンドを体験する

```
  /test-coverage       カバレッジ分析（80%以上が目標）
  /refactor-clean      不要コード検出・削除提案
  /build-fix           ビルドエラーの原因特定・修正
```

### やること

```
/test-coverage
/refactor-clean
/build-fix          ← ビルドエラーがある場合
```

### 確認ポイント

- [ ] `/test-coverage` でカバレッジが表示されたか
- [ ] `/refactor-clean` で不要コードが検出されたか
- [ ] `/build-fix` でビルドエラーが修正されたか（エラーがある場合）

> 全コマンド一覧（19個） → [Guide.md: スラッシュコマンド](./Guide.md#スラッシュコマンド)

---

## 全体のまとめ

```
  ┌──────────────────────────────────────────────────────────────┐
  │                      学んだことの全体像                        │
  │                                                              │
  │   Work    学んだこと                     使った機能            │
  │   ────   ──────────────────────        ─────────────────     │
  │    1     コードの前に計画を立てる         /plan, planner       │
  │    2     テストを先に書く(ユニット)       /tdd, tdd-guide      │
  │    3     コミット前にレビューする         /code-review, rules  │
  │   ★4     Playwright E2E + TDD          Playwright, RED→GREEN │
  │    5     ブラウザを直接操作              Playwright MCP       │
  │    6     最新ドキュメントを取得           Context7 MCP         │
  │    7     専門エージェント使い分け         agents               │
  │    8     ルールの自動適用               rules/security.md     │
  │    9     フックの自動実行               hooks                 │
  │   10     応用コマンド                   /test-coverage 等     │
  │                                                              │
  └──────────────────────────────────────────────────────────────┘

  カバーした機能:
  ✓ スラッシュコマンド  (Work 1, 10)
  ✓ エージェント       (Work 7)
  ✓ ルール            (Work 8)
  ✓ フック            (Work 9)
  ✓ MCP              (Work 5, 6)
  ✓ TDDワークフロー    (Work 2, 4)
```

---

## コンテキストウィンドウの管理

```
  ⚠ MCP を入れすぎると使える記憶容量が減る！

  MCP なし:  ████████████████████████  200k
  MCP 10個:  ████████████████░░░░░░░░  150k
  MCP 30個:  ████████░░░░░░░░░░░░░░░░   70k  ← 危険！

  推奨: プロジェクトごとに 10個以下、ツールは 80個以下
  確認: /mcp コマンドで現在の状態を確認
```

---

## ワークの進め方

```
  推奨順序
  ════════

  基本ワーク（1-7）を先に ──→ 追加ワーク（8-10）へ

  全10ワーク、各ワーク数分でサクッと完了できます。
  時間がない場合は Work 1, 2, 4 だけでも OK
  （計画 → TDD → Playwright E2E+TDD で核心を体験）
```

---

## 次のステップ

ワークを完了したら：

1. **自分のプロジェクトに適用**: `cp -r .claude/ ~/your-project/.claude/`
2. **カスタムルールを追加**: `.claude/rules/` にプロジェクト固有のルールを追加
3. **スキルを作成**: `/skill-create` でプロジェクトのパターンをスキル化
4. **フックをカスタマイズ**: `.claude/settings.local.json` でフックを調整

---

## 参考リンク

- [Guide.md（詳細リファレンス）](./Guide.md)
- [everything-claude-code リポジトリ](https://github.com/affaan-m/everything-claude-code)

---
